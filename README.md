## About this project
This project is about integrating a module in the [bigbluebutton](https://github.com/bigbluebutton) (open source web conferencing) application which makes it possible to either chat or speak with an voice assistent by communicating with a [Natural Language Understanding API](https://github.com/Ameckto/Natural-Language-Understanding-API) in English. 


*here will be a video*


## Table of contents

* [Installation](#installation)
* [What is the benefit for the end client](#how-to-start-the-API)
* [How does it work](#how-to-start-the-API)
* [String similarity test](#How-to-train-the-model)
* [License](#license)


## Installation

In this section I will talk about what you neet to do to bring your voice assistent within your bigbluebutton application to live. 

Before you start you need to have a full biglbuebutton server running. You can installl one by fallowing the official guide [here](https://docs.bigbluebutton.org/2.2/install.html). 

You also need to fallow this development guide [here](https://docs.bigbluebutton.org/2.2/dev.html) but change the fallowing: 
    dont fork their bigbluebutton repository, fork this one
    fallow the guide and just clone this repository into your ~/dev folder
    

In order to identify the intent of the user and his mentioned entities like "hey bigbluebutton mute Steffen" which would result in a wake_up+mute intent and the entitie Steffen you need to install the [Natural Language Understanding API](https://github.com/Ameckto/Natural-Language-Understanding-API). 

Optional:
If you want to enable the commands via the microphone please notice that you need to fallow this guide to transcript the audio (generated by the users microphones).


Now you need to install the string similarity package which is used to be able to identify missspelled names or nicknames as users within a bigbluebutton meeting without actually typing the 100% correct name like Niklas will be identified as Niklas_93 if Niklas is present and online within the meeting. 

Navigate to your bigbluebutton-html5 folder by running: 
```sh
cd ~/dev/bigbluebutton/bigbluebutton-html5
```

Install the string similarity package by running: 
```sh
npm install string-similarity --save
```

It is also nessesary to roll back some code changes which I have used for my development process: [commit]

https://github.com/Ameckto/bigbluebutton/commit/37941d1cf4f10301790b12491854cea3676d84ad



## Voice Assistent Module

In this section you will install the RASA package and clone the Git repository. 

To install the RASA package first create a project folder and a virtual environment to avoid conflicts.  

To create a project folder run:
```sh
mkdir <your_project_name>
```

To move into the folder run: 
```sh
cd <your_project_name>
```

To be able to create a virtual environment in python3 you need to install the fallowing package: 
```sh
sudo apt install python3-venv
```

Now, create a virtual environment (venv) by running: 
```sh
python3 -m venv ./<your_virtual_environment_name>
```

To activate your newly created virtual environment run:
```sh
source ./<your_virtual_environment_name>/bin/activate
```
`Hint`: Keep in mind that you have to be in <your_project_name> folder to activate your venv. 

Now install the RASA package by running: 
```sh
pip install rasa
```
After running the above command check the version of RASA by running: 
```sh
rasa --version
```
It should be the version Rasa 1.10.14.

After installing RASA make sure that you are in <your_project_name> folder and clone the Git repository by running: 
```sh
git clone https://github.com/Ameckto/Natural-Language-Understanding-API.git
```

The repository you just downloaded makes usage of the Spacy package which is a free open source library for Natural Language Processing in Python.
Thus you need to install it by running:

```sh
pip install spacy
```

The repository also makes usage of the Spacy en_core_web_md pretrained statistical model for English. Download it by running:
```sh
python -m spacy download en_core_web_md
```

You also need to link the model by running: 
```sh
python -m spacy link en_core_web_md en
```

By now, you have installed RASA successfully!  

## NGINX

In this section you will install a NGINX web server which will make it possible to access your server with a public ip adress. 

First install the NGINX package by running: 
```sh
apt install nginx
```
Now unlink the default landing page of the NGNIX server by running: 
```sh
unlink /etc/nginx/sites-enabled/default
```
To link it to our local RASA server first navigate to the site-variables folder by running: 
```sh
cd /etc/nginx/sites-available
```

Create a new file called reverse-proxy.conf by running: 
```sh
nano reverse-proxy.conf
```

Now copy paste the fallowing code (called server block) and change the line <server_name example.de www<i></i>.example.de;> accordingly to your domain address: 

`Hint`: After pasting save the file by pressing Ctrl + O and exit it after by pressing Ctrl + X

```sh
server {
        listen 80;
        listen [::]:80;
        
        server_name example.de www.example.de;
	      add_header 'Access-Control-Allow-Origin' '*';
  
        access_log /var/log/nginx/reverse-access.log;
        error_log /var/log/nginx/reverse-error.log;

        location / {
                    proxy_pass http://localhost:5000;
  }
}
```

Now stay in the folder and copy the file you just created and edited to the /etc/nginx/sites-enabled folder by running:
```sh
ln -s /etc/nginx/sites-available/reverse-proxy.conf /etc/nginx/sites-enabled/reverse-proxy.conf
```

You can check the syntax of your reverse-proxy.conf file by running: 
```sh
nginx -t
```
Which should be successfull. If so you have installed your NGINX web server successfully!

## HTTPS certificate
I this section you will get a certificate from [Let's Encript](https://letsencrypt.org/) which is for free and makes your server accessible over the https protocol.
You also alter your NGINX configuration (automatically). 

First you will use the classic certbot package. You can install it by running:

```sh
sudo snap install --classic certbot
```

To ensure that the certbot is working properly run: 
```sh
sudo ln -s /snap/bin/certbot /usr/bin/certbot
```
Now you will use the certbot to deploy the certificate for your name server and enable https.
You will need to fallow a dialogue. The certbot also changes your reverse-proxy.conf file accordingly. 
```sh
sudo certbot --nginx
```


To get the certbot automatically renew your certificates before they expire run:
```sh
sudo certbot renew --dry-run
```

Now your NGINX web server should be automatically accessible over https.  

## How to start the API

In this section you will make the server running and waiting for your requests. 

First navigate to your project folder:

```sh
cd <your_project_name>
```

Activate your venv by running: 
```sh
source ./<your_virtual_environment_name>/bin/activate
```

Now navigate to your repository folder by running:
```sh
cd Natural-Language-Understanding-API
```

Start the RASA server with the bigbluebutton (which is a open source web conferencing software) model on port 5000
```sh
rasa run --enable-api -m models/bigbluebutton.tar.gz -p 5000
```
`Hint`: You can stop the server by pressing Ctrl + c

Your NGNIX Server should run be default. If not you can get the current status by running: 
```sh
sudo systemctl status nginx
```

Stop the server by running: 
```sh
sudo systemctl stop nginx
```

Start the server by running: 
```sh
sudo systemctl start nginx
```
`Hint`: You need to open a new shell if you started your RASA server within the current shell to be able to do something different than watching the RASA server running on http:<i></i>//localhost:5000. 

Now you can navigate to your <example.com> domain and enjoy your rasa server running with the https protocol ready for your requests.

You can also test it on your ubuntu machine by curling it by running: 

```sh
curl localhost:5000/model/parse -d "{\"text\":\"hey big blue button mute Steffen please\"}"
```

Which should return:

{"intent":{"name":"wake_up+mute","confidence":0.3771627578},"entities":[{"entity":"PERSON","start":25,"end":32,"confidence_entity":0.8901095716,"value":"Steffen","extractor":"CRFEntityExtractor"},{"entity":"PERSON","value":"Steffen","start":25,"confidence":null,"end":32,"extractor":"SpacyEntityExtractor"}],"intent_ranking":[{"name":"wake_up+mute","confidence":0.3771627578},{"name":"wake_up+give_presenter","confidence":0.17544354},{"name":"wake_up","confidence":0.0876565409},{"name":"wake_up+out_of_scope","confidence":0.0771458429},{"name":"out_of_scope","confidence":0.074283539},{"name":"wake_up+summarize","confidence":0.0429107613},{"name":"wake_up+raise_hand","confidence":0.0404340016},{"name":"wake_up+share_screen","confidence":0.0355202072},{"name":"mute","confidence":0.0290603673},{"name":"give_presenter","confidence":0.0201405552}],"text":"hey big blue button mute Steffen please"}


## How to train the model

In this section you will learn how quickly you can change the training data and change the entity extractor pipeline thus your model running on the rasa server will meet your individual needs.

Activate your virtual environment and move to the repository folder (explained above).

To train a model run: 

```sh
rasa train nlu
```

This creates a new model which is stored in the model folder. The data used to train the model is stored in the nlu.md file which is located in the data folder. 
You can just change the data and re-run the above command to train your own model. 
Althow training the model is pretty straight forward please visit the [official rasa documentation](https://rasa.com/docs/rasa/nlu-training-data/) for more details. 



You can make your API Server to use your own model by altering the rasa run command:   

```sh
rasa run --enable-api -m models/<your_model_name> -p 5000
```

It is really that simple!

`Hint`: You can access the models pipeline by opening the config.yml file. I have reduced the dimensions of the SpacyEntityExtractor to ["PERSON"] which let the extractor only be able to extract persons. Delete this line if you also want to identify other entities e.g. organisations. 
    

## How to test the model

In this section I will give you an example how you can test your model in Python Jupyter Notebook. 
I used a local RASA server and Windows for this purpose. You can also use another operating system and your public accessible RASA server as well but you need to change the server address accordingly in the intent_entity_confidence_test.ipynb file. 

The testfile is located at:

```sh
Natural-Language-Understanding-API/tests/intent_entity_confidence_test.ipynb
```
`Hint`: If GitHub says: *"Sorry"* , you can view the file here: https://nbviewer.jupyter.org/github/Ameckto/Natural-Language-Understanding-API/blob/main/tests/intent_entity_confidence_test.ipynb

The test file sends pre-defined use cases to the RASA server and evalutes the reponses. It also prints charts to find a good min_confidence value which can filter out wrong results (hopefully). 

You can simply add more or other use cases by altering the according dictionaries and re-run the script. 


## License

This project is open source for everyone. 

